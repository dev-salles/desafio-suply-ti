#!/usr/bin/env bash

# Aborta o script se algum comando falhar
set -e

# Usamos o caminho completo /usr/bin/php8.3 para evitar Operation Not Permitted
if [ ! -z "$DATABASE_URL" ]; then
    echo "Configurando banco de dados..."
    /usr/bin/php8.3 /var/www/html/artisan migrate --force
fi

echo "Limpando e gerando caches..."
/usr/bin/php8.3 /var/www/html/artisan config:cache
/usr/bin/php8.3 /var/www/html/artisan route:cache
/usr/bin/php8.3 /var/www/html/artisan view:cache

echo "Iniciando o Supervisor..."

# Inicia o supervisord em primeiro plano
exec /usr/bin/supervisord -n -c /etc/supervisor/conf.d/supervisord.conf