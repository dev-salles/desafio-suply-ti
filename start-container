#!/usr/bin/env bash

# Aborta o script se algum comando falhar
set -e

# Se a variável DATABASE_URL existir, tenta rodar as migrations antes de subir o site
if [ ! -z "$DATABASE_URL" ]; then
    echo "Configurando banco de dados..."
    php artisan migrate --force
fi

# Limpa e gera os caches necessários para performance em produção
php artisan config:cache
php artisan route:cache
php artisan view:cache

echo "Iniciando o Supervisor..."

# Inicia o supervisord em primeiro plano (-n) 
# Isso mantém o container vivo e gerencia o processo do PHP
exec /usr/bin/supervisord -n -c /etc/supervisor/conf.d/supervisord.conf